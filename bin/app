#!/usr/bin/env node

/**
 * Dependencies
 */
var error = require('debug')('app:error')
  , debug = require('debug')('app')
  , formatError = require('log').formatError
  , cli = require('commander')
  , app = require('boot')

/**
 * Application
 */
cli.option('-p, --port <n>', 'set port [3000]', parseInt)
   .parse(process.argv)

app.set('port', cli.port || process.env.PORT || 3000)
   .listen(app.get('port'), listen)

process.on('SIGINT',  quit)
process.on('SIGTERM', quit)
process.on('uncaughtException', die)

function listen () {
  debug('listening on port %d', app.get('port'))
}

function quit () {
  debug('quitting')
  process.exit(0)
}

function die (err) {
  error(formatError(err))
  debug('uncaught exception, quitting')
  process.exit(1)
}
